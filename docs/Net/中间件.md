# 中间件

  中间件在ASP.NET Core面试中的高频考点，凡是要求.NET Core招聘的几乎都有会问到中间件的知识，本文将介绍常考的中间件面试题供大家参考。本文首先列出的是问题，大家可以先自己尝试回答一下，然后再查看答案解析，加深理解。

**问题：**

1、什么是.NET Core中的中间件？请解释一下中间件的概念和作用。

2、您在.NET Core开发中使用过哪些常见的中间件？请列举一些，并描述它们的功能和用途。

3、在.NET Core中，如何编写自定义的中间件？请描述一下自定义中间件的开发过程。并介绍你在什么功能点使用中间件。

4、中间件的执行顺序是怎样的？如果有多个中间件，它们是如何按顺序执行的？

5、请解释一下.NET Core中间件管道的概念和原理，以及它在请求处理过程中的作用。

6、中间件如何处理HTTP请求和响应？请描述一下中间件在请求和响应流程中的处理方式。

7、您如何在.NET Core应用程序中配置和注册中间件？请谈谈您的经验和做法。

8、在开发过程中，您遇到过哪些与中间件相关的问题？请分享一下您是如何解决这些问题的。



**答案：**

1、什么是.NET Core中的中间件？请解释一下中间件的概念和作用。

答：中间件是一种装配到应用管道以处理请求和响应的软件。在.NET Core中，中间件是一种可插拔的组件，用于处理HTTP请求和响应。它们被链接在一起，按照顺序执行，以提供特定的功能或逻辑。中间件可以拦截请求、修改响应、执行某些操作，或者将请求传递给下一个中间件。

中间件的作用是在请求处理过程中执行特定的功能或逻辑。它们可以用于处理身份验证、授权、路由、异常处理、日志记录、缓存、压缩等。中间件提供了一种灵活的方式来扩展和定制应用程序的请求处理流程，以满足不同的需求。

中间件的概念基于管道模型，请求经过管道中的每个中间件，并按照它们在应用程序中注册的顺序执行。每个中间件可以选择将请求传递给下一个中间件，也可以中断请求处理并返回响应。通过组合和配置不同的中间件，开发人员可以构建出适应自己需求的请求处理管道。

[.NET Core基础：白话管道中间件](http://mp.weixin.qq.com/s?__biz=MzI2NDE1MDE1MQ==&mid=2650839885&idx=1&sn=b8b5ec9990ca89c724b921d27d991fb6&chksm=f14536a5c632bfb3d80b40ff64b052a01cd2c2435d22f9b682613cfab05614f3b541687490b7&scene=21#wechat_redirect)



2、您在.NET Core开发中使用过哪些常见的中间件？请列举一些，并描述它们的功能和用途。

答：Authentication中间件：用于身份验证和授权。

Routing中间件：用于路由请求到不同的处理程序或控制器。

Static Files中间件：用于提供静态文件（如CSS、JavaScript、图像等）的访问。

Logging中间件：用于记录应用程序的日志信息。

Exception Handling中间件：用于捕获和处理应用程序中的异常。

[ASP.NET Core官方常用内置中间件](http://mp.weixin.qq.com/s?__biz=MzI2NDE1MDE1MQ==&mid=2650843852&idx=1&sn=ed9574ca97fa20af1b9bbc789f91bed6&chksm=f1450724c6328e32e938a0611174c6a40bd0bfc05c0969d6b6722089bf947c023481a3a0106c&scene=21#wechat_redirect)



3、在.NET Core中，如何编写自定义的中间件？请描述一下自定义中间件的开发过程。并介绍你在什么功能点使用中间件。

答：编写自定义中间件的步骤如下：

创建一个类，实现RequestDelegate委托的方法签名，该委托接受HttpContext对象作为参数。在方法中编写自定义逻辑，对请求和响应进行处理。可以选择性地调用next参数的Invoke方法，以将请求传递给下一个中间件。最后注册自定义中间件到应用程序的中间件管道中。这只是一种创建方式，另外的方式请看如下链接。

[ASP.NET Core实现自定义中间件的三种方式](http://mp.weixin.qq.com/s?__biz=MzI2NDE1MDE1MQ==&mid=2650846651&idx=1&sn=c2b94b4f30156fc1a57b919a84718be7&chksm=f1451853c6329145c7434e443ef333cb70e209e54902ff590ffe9274af179dd6a869f78ab6ec&scene=21#wechat_redirect)

功能点可以自己吹牛，有自定义日志中间件、自定义异常中间件、自定义授权鉴权中间件等。



4、中间件的执行顺序是怎样的？如果有多个中间件，它们是如何按顺序执行的？

答：中间件在ASP.NET Core应用程序中按照它们在中间件管道中注册的顺序执行。当应用程序接收到一个HTTP请求时，请求会经过管道中的每个中间件，并按照注册顺序执行它们的功能。另外默认中间件必须安装顺序去执行，比如鉴权和授权就不能搞反了，否则会有问题的。



[面试必备：聊聊ASP.NET CORE 中间件顺序？](http://mp.weixin.qq.com/s?__biz=MzI2NDE1MDE1MQ==&mid=2650837896&idx=1&sn=97fb060b62098db1184506bd274a157f&chksm=f1453e60c632b776498d89b655973fe541f9dc3352d3e61fa0f000a1f0da318b7219574a34c2&scene=21#wechat_redirect)



5、请解释一下.NET Core中间件管道的概念和原理，以及它在请求处理过程中的作用。

答：中间件管道是由一系列中间件组成的链式结构，用于处理HTTP请求和响应。当请求到达应用程序时，它会经过管道中的每个中间件，并按顺序执行各自的功能。中间件管道提供了一种可配置的方式来定制请求处理流程。如下官方的管道图：

![图片](https://mmbiz.qpic.cn/sz_mmbiz_png/oDaAmt9QDicS3XaflHlW39UqxLia2zUzMXgZhksNJMl7MJpsJmngTA8v7kGaoOZgnNiam2fy2r3EbfBsWEKcdwqTQ/640?wx_fmt=png&wxfrom=5&wx_lazy=1&wx_co=1)

[详情可以看文章-->精：.NET Core 管道模型中间件及管道模拟实现](http://mp.weixin.qq.com/s?__biz=MzI2NDE1MDE1MQ==&mid=2650846583&idx=2&sn=2ad80ab8971764f38d9eacf960e33e27&chksm=f145189fc632918932ad0136846e86502478a4d4b2948daf1c48a3adfd335e39a71510d94c39&scene=21#wechat_redirect)



6、中间件如何处理HTTP请求和响应？请描述一下中间件在请求和响应流程中的处理方式。

答：中间件在ASP.NET Core中通过HttpContext对象来处理HTTP请求和响应。每个中间件都接收一个HttpContext对象作为参数，从中获取请求信息并生成响应。

在请求流程中，当一个HTTP请求到达应用程序时，它首先进入第一个中间件。中间件可以读取和修改HttpContext对象中的属性和方法，以获取请求的路径、查询参数、请求头、请求正文等信息。



7、您如何在.NET Core应用程序中配置和注册中间件？请谈谈您的经验和做法。

答：.NET5及以下版本和.NET6以上版本的注册方式略有不同。前者注册通常在Startup.cs文件的Configure方法中完成。通过调用app.UseMiddleware<TMiddleware>()方法，可以将中间件添加到应用程序的中间件管道中，并指定中间件的顺序。后者在Program.cs文件中通过builder.Build注册。

 

```c#
   var builder = WebApplication.CreateBuilder(args);//注册组件  //以下是注册中间件 
   var app = builder.Build();  
   app.UseMiddleware<CustomResponseMiddleware>();//自定义中间件注册  
   app.UseAuthentication();//系统中间件注册  
```



8、在开发过程中，您遇到过哪些与中间件相关的问题？请分享一下您是如何解决这些问题的。

答：比如中间件执行顺序，把鉴权和授权搞反了，导致认证调试失败。中间件与其它组件冲突。自定义中间件不好使等等。这个题大家可以根据自己的情况随意发挥。 

中间件在ASP.NET Core面试中的高频考点，凡是要求.NET Core招聘的几乎都有会问到中间件的知识，本文将介绍常考的中间件面试题供大家参考。本文首先列出的是问题，大家可以先自己尝试回答一下，然后再查看答案解析，加深理解。

